<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Model Server - Models</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/css/models_ui.css">
</head>
<body>
  <!-- Toast Container -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-check-circle-fill me-2"></i>
          <span id="successMessage"></span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
    <div id="errorToast" class="toast align-items-center text-bg-danger border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <span id="errorMessage"></span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <div class="container py-5">
    <h1 class="text-center mb-4 fw-bold">
      <i class="bi bi-box-seam me-2"></i>ML Models
    </h1>
    <p class="help-description text-center mb-5">
      Models are loaded from
      {% if model_source == "local_filesystem" %}
        the <code>models/</code> folder.
      {% elif model_source == "github" %}
        GitHub repository <code>{{ github_repo }}</code>.
      {% else %}
        {{ model_source }}
      {% endif %}
      <br>
      <span class="text-muted">
        Click <strong>Activate</strong> to load a model and enable predictions.
        Active models can be tested via their prediction endpoints.
      </span>
    </p>

    {% if models|length == 0 %}
    <div class="alert alert-info text-center" role="alert">
      <i class="bi bi-info-circle me-2"></i>
      No models available. Add models to your repository or models folder.
    </div>
    {% else %}
    <div class="row g-4 justify-content-center" id="modelsContainer">
      {% for model in models %}
      <div class="col-sm-6 col-md-4 col-lg-3">
        <div class="model-card-wrapper" data-model-name="{{ model.model_name }}" data-is-active="{{ model.is_active|lower }}">
          
          {% if model.is_active %}
          <!-- ACTIVE MODEL - Flip Card -->
          <div class="flip-card active-model">
            <div class="flip-card-inner">
              <!-- FRONT -->
              <div class="flip-card-front card shadow-sm border-success border-2">
                <div class="card-body d-flex flex-column justify-content-center text-center">
                  <div class="status-badge badge bg-success mb-2">
                    <i class="bi bi-check-circle-fill me-1"></i>Active
                  </div>
                  <h5 class="card-title fw-bold mb-2">{{ model.model_name }}</h5>
                  <p class="card-text mb-1"><strong>Type:</strong> {{ model.model_info.type }}</p>
                  <p class="card-text mb-0">
                    <strong>Endpoint:</strong><br>
                    <code class="text-success">{{ model.endpoint_url }}</code>
                  </p>
                  <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm flip-btn">
                      <i class="bi bi-info-circle me-1"></i>More Info
                    </button>
                    <button class="btn btn-outline-danger btn-sm deactivate-btn" data-model-name="{{ model.model_name }}">
                      <i class="bi bi-x-circle me-1"></i>Deactivate
                    </button>
                  </div>
                </div>
              </div>
              <!-- BACK -->
              <div class="flip-card-back card shadow-sm border-success border-2">
                <div class="card-body overflow-auto">
                  <h6 class="fw-bold text-center text-success mb-3">Model Details</h6>
                  <pre class="small text-start bg-light p-2 rounded model-info-json">{{ model.model_info | tojson(indent=2) }}</pre>
                  <button class="btn btn-outline-secondary btn-sm w-100 mt-2 flip-btn">
                    <i class="bi bi-arrow-left me-1"></i>Back
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          {% else %}
          <!-- INACTIVE MODEL - Simple Card -->
          <div class="simple-card inactive-model">
            <div class="card shadow-sm border-secondary border-1">
              <div class="card-body d-flex flex-column justify-content-center text-center">
                <div class="status-badge badge bg-secondary mb-2">
                  <i class="bi bi-dash-circle me-1"></i>Inactive
                </div>
                <h5 class="card-title fw-bold mb-2 text-muted">{{ model.model_name }}</h5>
                <p class="card-text text-muted mb-1">
                  <small><strong>Source:</strong> {{ model.source }}</small>
                </p>
                <p class="card-text text-muted mb-3">
                  <small><strong>Path:</strong> {{ model.model_path }}</small>
                </p>
                <button class="btn btn-primary activate-btn" data-model-name="{{ model.model_name }}">
                  <i class="bi bi-play-circle me-1"></i>Activate
                </button>
              </div>
            </div>
          </div>
          {% endif %}
          
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom Script -->
  <script src="/static/js/models_ui.js"></script>
</body>
</html>
